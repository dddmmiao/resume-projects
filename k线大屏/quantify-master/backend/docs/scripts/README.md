# æ•°æ®åº“ç®¡ç†è„šæœ¬ä½¿ç”¨è¯´æ˜

## ğŸ“‹ **æ¦‚è¿°**

æœ¬ç›®å½•åŒ…å«äº†ç”¨äºæ•°æ®åº“ç®¡ç†å’Œç»´æŠ¤çš„å„ç§è„šæœ¬å·¥å…·ï¼Œå¸®åŠ©è§£å†³æ•°æ®åº“è¡¨åä¸ä¸€è‡´ç­‰é—®é¢˜ã€‚

## ğŸ› ï¸ **å¯ç”¨è„šæœ¬**

### **1. è¡¨åæ£€æŸ¥è„šæœ¬**

#### **æ–‡ä»¶å**: `check_table_names.py`
#### **åŠŸèƒ½**: æ£€æŸ¥æ•°æ®åº“ä¸­çš„è¡¨åæ˜¯å¦ç¬¦åˆå‘½åè§„èŒƒ
#### **ç”¨æ³•**:
```bash
cd backend/scripts
python3 check_table_names.py
```

#### **è¾“å‡ºç¤ºä¾‹**:
```
2025-08-31 12:00:00 - INFO - æ•°æ®åº“ä¸­å…±æœ‰ 45 ä¸ªè¡¨

=== è¡¨ååˆ†ç±»ç»“æœ ===

stock_klines (3 ä¸ª):
  - stock_klines_2023
  - stock_klines_2024
  - stock_klines_2025

convertible_bond_klines (3 ä¸ª):
  - convertible_bond_klines_2023
  - convertible_bond_klines_2024
  - convertible_bond_klines_2025

concept_klines (3 ä¸ª):
  - concept_klines_2023
  - concept_klines_2024
  - concept_klines_2025

industry_klines (3 ä¸ª):
  - industry_klines_2023
  - industry_klines_2024
  - industry_klines_2025

cb_klines_old (0 ä¸ª): æ— 

basic_tables (9 ä¸ª):
  - convertible_bond_calls
  - convertible_bond_issues
  - convertible_bond_shares
  - convertible_bonds
  - concepts
  - industries
  - stock_concepts
  - stock_industries
  - stocks

other_tables (23 ä¸ª):
  - ... (å…¶ä»–è¡¨)

=== é—®é¢˜æ£€æŸ¥ç»“æœ ===
âœ… æœªå‘ç°æ˜æ˜¾çš„è¡¨åé—®é¢˜
```

### **2. è¡¨åè¿ç§»è„šæœ¬**

#### **æ–‡ä»¶å**: `migrate_table_names.py`
#### **åŠŸèƒ½**: å°†æ—§çš„è¡¨åè¿ç§»åˆ°æ–°çš„å‘½åè§„èŒƒ
#### **ç”¨æ³•**:

##### **æ£€æŸ¥æ—§è¡¨å**:
```bash
python3 migrate_table_names.py --check
```

##### **æ¨¡æ‹Ÿè¿ç§»**:
```bash
python3 migrate_table_names.py --dry-run
```

##### **æ‰§è¡Œå®é™…è¿ç§»**:
```bash
python3 migrate_table_names.py --execute
```

##### **æ¸…ç†æ—§è¡¨**:
```bash
python3 migrate_table_names.py --cleanup
```

#### **è¿ç§»æµç¨‹**:
1. **å¤‡ä»½**: è‡ªåŠ¨åˆ›å»º `{æ—§è¡¨å}_backup` å¤‡ä»½è¡¨
2. **åˆ›å»ºæ–°è¡¨**: ä½¿ç”¨æ–°å‘½åè§„èŒƒåˆ›å»ºè¡¨
3. **å¤åˆ¶æ•°æ®**: å°†æ•°æ®ä»æ—§è¡¨å¤åˆ¶åˆ°æ–°è¡¨
4. **éªŒè¯**: æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
5. **æ¸…ç†**: åˆ é™¤æ—§è¡¨ï¼ˆå¯é€‰ï¼‰

#### **è¾“å‡ºç¤ºä¾‹**:
```
=== æ£€æŸ¥æ—§è¡¨å ===
å‘ç° 2 ä¸ªéœ€è¦è¿ç§»çš„æ—§è¡¨å:
  - cb_klines_2023
  - cb_klines_2024

=== æ¨¡æ‹Ÿè¿ç§» ===
å‡†å¤‡è¿ç§»è¡¨: cb_klines_2023 -> convertible_bond_klines_2023
ğŸ” æ¨¡æ‹Ÿè¿ç§»: å°†åˆ›å»ºè¡¨ convertible_bond_klines_2023
ğŸ” æ¨¡æ‹Ÿè¿ç§»: å°†å¤åˆ¶æ•°æ®ä» cb_klines_2023 åˆ° convertible_bond_klines_2023

å‡†å¤‡è¿ç§»è¡¨: cb_klines_2024 -> convertible_bond_klines_2024
ğŸ” æ¨¡æ‹Ÿè¿ç§»: å°†åˆ›å»ºè¡¨ convertible_bond_klines_2024
ğŸ” æ¨¡æ‹Ÿè¿ç§»: å°†å¤åˆ¶æ•°æ®ä» cb_klines_2024 åˆ° convertible_bond_klines_2024

=== è¿ç§»ç»“æœ ===
æˆåŠŸ: 2 ä¸ª
å¤±è´¥: 0 ä¸ª
ğŸ” è¿™æ˜¯æ¨¡æ‹Ÿè¿è¡Œï¼Œå®é™…è¿ç§»è¯·ä½¿ç”¨ --execute å‚æ•°
```

### **3. ç»Ÿä¸€æ•°æ®åº“ç®¡ç†è„šæœ¬**

#### **æ–‡ä»¶å**: `unified_database_manager.py`
#### **åŠŸèƒ½**: ç»Ÿä¸€çš„æ•°æ®åº“ç®¡ç†å·¥å…·
#### **ç”¨æ³•**:

##### **æ˜¾ç¤ºæ•°æ®åº“ä¿¡æ¯**:
```bash
python3 unified_database_manager.py --info
```

##### **éªŒè¯è¡¨ç»“æ„**:
```bash
python3 unified_database_manager.py --verify
```

##### **è¿ç§»æ•°æ®åº“**:
```bash
python3 unified_database_manager.py --migrate
```

##### **é‡å»ºæ•°æ®åº“**:
```bash
python3 unified_database_manager.py --rebuild --confirm
```

### **4. è‚¡ç¥¨è¡¨ç»“æ„è¿ç§»è„šæœ¬**

#### **æ–‡ä»¶å**: `migrate_stock_table.py`
#### **åŠŸèƒ½**: å¤„ç†Stockè¡¨ä»ts_codeä¸»é”®åˆ°idè‡ªå¢ä¸»é”®çš„è¿ç§»
#### **ç”¨æ³•**:

##### **æ£€æŸ¥å½“å‰è¡¨ç»“æ„**:
```bash
python3 migrate_stock_table.py --mode check
```

##### **æ‰§è¡Œæ•°æ®è¿ç§»**:
```bash
python3 migrate_stock_table.py --mode migrate
```

##### **å¼ºåˆ¶é‡å»ºè¡¨**:
```bash
python3 migrate_stock_table.py --mode rebuild
```

##### **éªŒè¯è¿ç§»ç»“æœ**:
```bash
python3 migrate_stock_table.py --mode verify
```

##### **ä¿ç•™å¤‡ä»½è¡¨**:
```bash
python3 migrate_stock_table.py --mode migrate --backup
```

#### **è¿ç§»æµç¨‹**:
1. **æ£€æŸ¥**: åˆ†æå½“å‰è¡¨ç»“æ„ï¼Œç¡®å®šæ˜¯å¦éœ€è¦è¿ç§»
2. **å¤‡ä»½**: è‡ªåŠ¨åˆ›å»º `stocks_backup` å¤‡ä»½è¡¨
3. **é‡å»º**: åˆ›å»ºæ–°çš„è¡¨ç»“æ„ï¼ˆidè‡ªå¢ä¸»é”®ï¼Œts_codeå”¯ä¸€é”®ï¼‰
4. **è¿ç§»**: å°†æ•°æ®ä»å¤‡ä»½è¡¨è¿ç§»åˆ°æ–°è¡¨
5. **éªŒè¯**: æ£€æŸ¥è¡¨ç»“æ„ã€æ•°æ®å®Œæ•´æ€§å’Œçº¦æŸ
6. **æ¸…ç†**: åˆ é™¤å¤‡ä»½è¡¨ï¼ˆå¯é€‰ï¼‰

### **5. è‚¡ç¥¨è¡¨é‡å»ºè„šæœ¬**

#### **æ–‡ä»¶å**: `rebuild_stock_table.py`
#### **åŠŸèƒ½**: å¿«é€Ÿé‡å»ºStockè¡¨ï¼ˆä¸ä¿ç•™æ•°æ®ï¼‰
#### **ç”¨æ³•**:

```bash
python3 rebuild_stock_table.py
```

#### **ç‰¹ç‚¹**:
- ç›´æ¥åˆ é™¤ç°æœ‰è¡¨å¹¶é‡å»º
- ä¸ä¿ç•™å†å²æ•°æ®
- é€‚ç”¨äºå¼€å‘ç¯å¢ƒæˆ–æ•°æ®å¯é‡æ–°åŒæ­¥çš„åœºæ™¯

### **6. å¯è½¬å€ºèµå›è¡¨é‡å»ºè„šæœ¬**

#### **æ–‡ä»¶å**: `rebuild_bond_call_table.py`
#### **åŠŸèƒ½**: é‡å»ºå¯è½¬å€ºèµå›ä¿¡æ¯è¡¨ï¼Œè§£å†³é‡å¤æ•°æ®é—®é¢˜
#### **ç”¨æ³•**:

```bash
python3 rebuild_bond_call_table.py
```

## ğŸš¨ **é‡è¦æ³¨æ„äº‹é¡¹**

### **1. è¿ç§»å‰å‡†å¤‡**
- ç¡®ä¿æ•°æ®åº“è¿æ¥æ­£å¸¸
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´
- å»ºè®®åœ¨éç”Ÿäº§ç¯å¢ƒå…ˆæµ‹è¯•

### **2. æ•°æ®å®‰å…¨**
- è¿ç§»è„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºå¤‡ä»½è¡¨
- å¤‡ä»½è¡¨æ ¼å¼: `{åŸè¡¨å}_backup`
- å»ºè®®åœ¨æ¸…ç†æ—§è¡¨å‰éªŒè¯æ•°æ®å®Œæ•´æ€§

### **3. å‘½åè§„èŒƒ**
- **è‚¡ç¥¨Kçº¿è¡¨**: `stock_klines_YYYY`
- **å¯è½¬å€ºKçº¿è¡¨**: `convertible_bond_klines_YYYY` âœ…
- **æ¦‚å¿µæŒ‡æ•°Kçº¿è¡¨**: `concept_klines_YYYY`
- **è¡Œä¸šæŒ‡æ•°Kçº¿è¡¨**: `industry_klines_YYYY`

### **4. åºŸå¼ƒçš„è¡¨å**
- **æ—§çš„å¯è½¬å€ºè¡¨å**: `cb_klines_YYYY` âŒ
- **æ›¿ä»£æ–¹æ¡ˆ**: `convertible_bond_klines_YYYY`

## ğŸ” **é—®é¢˜æ’æŸ¥**

### **1. æ£€æŸ¥è¡¨åä¸ä¸€è‡´**
```bash
# ä½¿ç”¨æ£€æŸ¥è„šæœ¬
python3 check_table_names.py

# æˆ–ç›´æ¥æŸ¥è¯¢æ•°æ®åº“
mysql -u username -p database_name -e "SHOW TABLES LIKE '%klines%'"
```

### **2. æ£€æŸ¥æ—§è¡¨å**
```bash
# æŸ¥æ‰¾ä»¥ cb_klines_ å¼€å¤´çš„è¡¨
mysql -u username -p database_name -e "SHOW TABLES LIKE 'cb_klines_%'"
```

### **3. æ£€æŸ¥æ–°è¡¨å**
```bash
# æŸ¥æ‰¾ä»¥ convertible_bond_klines_ å¼€å¤´çš„è¡¨
mysql -u username -p database_name -e "SHOW TABLES LIKE 'convertible_bond_klines_%'"
```

## ğŸ“š **ç›¸å…³æ–‡æ¡£**

- [æ•°æ®åº“è¡¨åè§„èŒƒ](../docs/TABLE_NAMING_CONVENTION.md)
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](../docs/DATABASE_DESIGN.md)
- [APIæ–‡æ¡£](../docs/API_REFERENCE.md)

## ğŸ†˜ **æ•…éšœæ’é™¤**

### **1. å¸¸è§é”™è¯¯**

#### **ModuleNotFoundError: No module named 'sqlalchemy'**
```bash
# å®‰è£…ä¾èµ–
pip install sqlalchemy pymysql

# æˆ–ä½¿ç”¨é¡¹ç›®è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate
```

#### **è¿æ¥æ•°æ®åº“å¤±è´¥**
- æ£€æŸ¥æ•°æ®åº“é…ç½®
- ç¡®è®¤æ•°æ®åº“æœåŠ¡è¿è¡ŒçŠ¶æ€
- éªŒè¯ç”¨æˆ·åå’Œå¯†ç 

#### **æƒé™ä¸è¶³**
- ç¡®ä¿æ•°æ®åº“ç”¨æˆ·æœ‰è¶³å¤Ÿæƒé™
- æ£€æŸ¥è¡¨çº§æƒé™è®¾ç½®

### **2. è·å–å¸®åŠ©**
- æŸ¥çœ‹è„šæœ¬çš„ `--help` å‚æ•°
- æ£€æŸ¥æ—¥å¿—è¾“å‡º
- å‚è€ƒç›¸å…³æ–‡æ¡£

## ğŸ“ **ä½¿ç”¨å»ºè®®**

### **1. ç”Ÿäº§ç¯å¢ƒä½¿ç”¨**
1. å…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯è„šæœ¬åŠŸèƒ½
2. åœ¨ä½å³°æœŸæ‰§è¡Œè¿ç§»æ“ä½œ
3. ç¡®ä¿æœ‰å®Œæ•´çš„å¤‡ä»½ç­–ç•¥
4. ç›‘æ§è¿ç§»è¿‡ç¨‹

### **2. å¼€å‘ç¯å¢ƒä½¿ç”¨**
1. å®šæœŸæ£€æŸ¥è¡¨åè§„èŒƒ
2. åŠæ—¶ä¿®å¤å‘½åä¸ä¸€è‡´é—®é¢˜
3. åœ¨ä»£ç å®¡æŸ¥ä¸­å…³æ³¨è¡¨åä½¿ç”¨

### **3. ç»´æŠ¤å»ºè®®**
1. å®šæœŸè¿è¡Œæ£€æŸ¥è„šæœ¬
2. ä¿æŒå‘½åè§„èŒƒçš„ä¸€è‡´æ€§
3. åŠæ—¶æ›´æ–°ç›¸å…³æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-08-31  
**ç»´æŠ¤äººå‘˜**: ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ  
**å®¡æ ¸çŠ¶æ€**: å·²å®¡æ ¸é€šè¿‡
