# ğŸ—ï¸ CyberBugOff é¡¹ç›®æ¶æ„æ–‡æ¡£

## é¡¹ç›®ç®€ä»‹

**CyberBugOff** æ˜¯ä¸€æ¬¾ä¸“ä¸º Apple Watch è®¾è®¡çš„äº’åŠ¨éŸ³æ•ˆåº”ç”¨ã€‚ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰å›¾ç‰‡å’ŒéŸ³æ•ˆï¼Œé€šè¿‡ç‚¹å‡»ã€æ‘‡æ™ƒã€è¡¨å† æ—‹è½¬ç­‰å¤šç§è§¦å‘æ–¹å¼ï¼Œè·å¾—ä¸ªæ€§åŒ–çš„è§†å¬åé¦ˆä½“éªŒã€‚

---

## ğŸ“Š æŠ€æœ¯æ ˆ

| æŠ€æœ¯é¢†åŸŸ | æŠ€æœ¯é€‰å‹ | è¯´æ˜ |
|---------|---------|------|
| **å¹³å°** | watchOS 10.0+ | ä¸“ä¸º Apple Watch ä¼˜åŒ– |
| **è¯­è¨€** | Swift 5.9+ | ç°ä»£ Swift ç‰¹æ€§ |
| **UI æ¡†æ¶** | SwiftUI | å£°æ˜å¼ UIï¼Œå“åº”å¼ç¼–ç¨‹ |
| **çŠ¶æ€ç®¡ç†** | Combine + @Published | å“åº”å¼æ•°æ®æµ |
| **éŸ³é¢‘å¼•æ“** | AVFoundation | é«˜æ€§èƒ½éŸ³é¢‘æ’­æ”¾ |
| **è¿åŠ¨ä¼ æ„Ÿ** | Core Motion | æ‘‡æ™ƒæ£€æµ‹ |
| **æ•°æ®æŒä¹…åŒ–** | UserDefaults + FileManager | è½»é‡çº§æœ¬åœ°å­˜å‚¨ |

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 1. åˆ†å±‚æ¶æ„ (Layered Architecture)

é¡¹ç›®é‡‡ç”¨**å››å±‚æ¶æ„**è®¾è®¡ï¼ŒèŒè´£æ¸…æ™°ï¼Œä¾¿äºç»´æŠ¤ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                    â”‚
â”‚              (Features + Shared Components)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ImageMode  â”‚ â”‚  Settings   â”‚ â”‚ SoundEdit/SoundList â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Business Logic Layer                  â”‚
â”‚                      (Core/Models)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ BugOffModel â”‚ â”‚ImageManager â”‚ â”‚SoundManager/Trigger â”‚â”‚
â”‚  â”‚   (Hub)     â”‚ â”‚             â”‚ â”‚      Manager        â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Service Layer                        â”‚
â”‚                    (Core/Services)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚AudioService â”‚ â”‚ DataService â”‚ â”‚PhotoSelectionServiceâ”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Utility Layer                        â”‚
â”‚                     (Core/Utils)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚CacheManager â”‚ â”‚   Logger    â”‚ â”‚ThumbnailGenerator   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Manager æ¨¡å¼ (Manager Pattern)

é¡¹ç›®é‡‡ç”¨ **Manager æ¨¡å¼** å°†ä¸šåŠ¡é€»è¾‘æŒ‰èŒè´£æ‹†åˆ†ï¼š

| Manager | èŒè´£ | å…³é”®åŠŸèƒ½ |
|---------|------|----------|
| **BugOffModel** | ä¸­å¤®çŠ¶æ€æ¢çº½ | åè°ƒå„ Managerï¼Œæä¾›ç»Ÿä¸€ API |
| **ImageManager** | å›¾ç‰‡èµ„æºç®¡ç† | å›¾ç‰‡åŠ è½½ã€è£å‰ªã€ç¼“å­˜ã€è®¾ç½® |
| **SoundManager** | éŸ³æ•ˆèµ„æºç®¡ç† | éŸ³æ•ˆé…ç½®ã€æ’­æ”¾åºåˆ—ã€æ¨¡å¼åˆ‡æ¢ |
| **TriggerManager** | è§¦å‘é€»è¾‘ç®¡ç† | ç‚¹å‡»/æ‘‡æ™ƒ/è¡¨å† æ£€æµ‹ã€è®¡æ•°ç»Ÿè®¡ |

### 3. çŠ¶æ€ç®¡ç† (State Management)

ä½¿ç”¨ **Combine æ¡†æ¶** å®ç°å“åº”å¼çŠ¶æ€ç®¡ç†ï¼š

```swift
// ä¸­å¤®çŠ¶æ€æ¨¡å‹
class BugOffModel: NSObject, ObservableObject {
    // Manager ä¾èµ–
    let imageManager = ImageManager()
    let soundManager = SoundManager()
    let triggerManager = TriggerManager()
    
    // å‘å¸ƒçŠ¶æ€å˜åŒ–
    @Published var defaultSounds: [String] = []
    @Published var imageMultiSoundIDs: [String: [SoundID]] = [:]
}

// è§†å›¾é€šè¿‡ @EnvironmentObject è®¢é˜…
struct ImageModeView: View {
    @ObservedObject var model: BugOffModel
    // UI è‡ªåŠ¨å“åº”çŠ¶æ€å˜åŒ–
}
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
CyberBugOff/
â”œâ”€â”€ ğŸ“± CyberBugOff iOS/                   # iOS é…å¥—åº”ç”¨
â”‚   â”œâ”€â”€ CyberBugOffApp.swift              # iOS å…¥å£ç‚¹
â”‚   â”œâ”€â”€ ContentView.swift                 # å¼•å¯¼ç•Œé¢
â”‚   â””â”€â”€ Assets.xcassets/                  # iOS èµ„æº
â”‚
â”œâ”€â”€ âŒš CyberBugOff Watch App/              # watchOS ä¸»åº”ç”¨
â”‚   â”œâ”€â”€ CyberBugOffApp.swift              # watchOS å…¥å£ç‚¹
â”‚   â”œâ”€â”€ ContentView.swift                 # ä¸»è§†å›¾è·¯ç”±
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ§  Core/                          # æ ¸å¿ƒä¸šåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ Config/                       # é…ç½®å¸¸é‡
â”‚   â”‚   â”‚   â””â”€â”€ AppConfig.swift           # å…¨å±€é…ç½®
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Models/                       # ä¸šåŠ¡æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ BugOffModel.swift         # ä¸­å¤®çŠ¶æ€ç®¡ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ DataModels.swift          # æ•°æ®ç»“æ„å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageManager.swift        # å›¾ç‰‡ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ SoundManager.swift        # éŸ³æ•ˆç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ TriggerManager.swift      # è§¦å‘ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Services/                     # æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ AudioService.swift        # éŸ³é¢‘æ’­æ”¾å¼•æ“
â”‚   â”‚   â”‚   â”œâ”€â”€ DataService.swift         # æ•°æ®æŒä¹…åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ DataStoreActor.swift      # æ•°æ®å­˜å‚¨ Actor
â”‚   â”‚   â”‚   â””â”€â”€ PhotoSelectionService.swift # ç…§ç‰‡é€‰æ‹©
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Sound/                        # éŸ³æ•ˆç›¸å…³
â”‚   â”‚   â”‚   â””â”€â”€ SoundDisplayNameManager.swift # éŸ³æ•ˆåç§°ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Utils/                        # å·¥å…·ç±»
â”‚   â”‚       â”œâ”€â”€ CacheManager.swift        # ç¼“å­˜ç®¡ç†
â”‚   â”‚       â”œâ”€â”€ Logger.swift              # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ ThumbnailGenerator.swift  # ç¼©ç•¥å›¾ç”Ÿæˆ
â”‚   â”‚       â”œâ”€â”€ PerformanceMonitor.swift  # æ€§èƒ½ç›‘æ§
â”‚   â”‚       â”œâ”€â”€ ErrorHandler.swift        # é”™è¯¯å¤„ç†
â”‚   â”‚       â””â”€â”€ ... (æ›´å¤šå·¥å…·ç±»)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ¨ Features/                      # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ ImageMode/                    # å›¾ç‰‡æ¨¡å¼
â”‚   â”‚   â”‚   â””â”€â”€ Views/
â”‚   â”‚   â”‚       â”œâ”€â”€ ImageModeView.swift   # å›¾ç‰‡ç½‘æ ¼
â”‚   â”‚   â”‚       â”œâ”€â”€ FullScreenImageView.swift # å…¨å±äº’åŠ¨
â”‚   â”‚   â”‚       â””â”€â”€ ImageGridManageView.swift # å›¾ç‰‡ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Settings/                     # è®¾ç½®æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ Views/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ImageSettingsView.swift # å›¾ç‰‡è®¾ç½®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AppSettingsView.swift   # åº”ç”¨è®¾ç½®
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ImageSizeEditorView.swift # å°ºå¯¸ç¼–è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ Utils/
â”‚   â”‚   â”‚       â””â”€â”€ CircleSelectionOptimizer.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ SoundEdit/                    # éŸ³æ•ˆç¼–è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ Views/
â”‚   â”‚   â”‚       â”œâ”€â”€ SoundModeSettingsView.swift # éŸ³æ•ˆè®¾ç½®
â”‚   â”‚   â”‚       â””â”€â”€ SoundBasicEditView.swift    # åŸºç¡€ç¼–è¾‘
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ SoundList/                    # éŸ³æ•ˆåˆ—è¡¨
â”‚   â”‚       â””â”€â”€ Views/
â”‚   â”‚           â”œâ”€â”€ SoundListView.swift   # éŸ³æ•ˆé€‰æ‹©
â”‚   â”‚           â”œâ”€â”€ SoundRecorderView.swift # å½•éŸ³åŠŸèƒ½
â”‚   â”‚           â””â”€â”€ MusicPickerView.swift # éŸ³ä¹å¯¼å…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ§© Shared/                        # å…±äº«ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ Components/                   # UI ç»„ä»¶åº“
â”‚   â”‚   â”‚   â”œâ”€â”€ TriggerCountToast.swift   # è§¦å‘åé¦ˆ Toast
â”‚   â”‚   â”‚   â”œâ”€â”€ UnifiedSwipableRow.swift  # æ»‘åŠ¨è¡Œç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ CircleSelectionOverlay.swift # åœˆé€‰è¦†ç›–å±‚
â”‚   â”‚   â”‚   â””â”€â”€ ... (21 ä¸ªç»„ä»¶)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Extensions/                   # Swift æ‰©å±•
â”‚   â”‚       â””â”€â”€ Extensions.swift
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ¨ Theme/                         # ä¸»é¢˜ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ AppTheme.swift                # é¢œè‰²ã€å­—ä½“ã€å°ºå¯¸
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“¦ Resources/                     # å†…ç½®èµ„æº
â”‚       â”œâ”€â”€ Sounds/                       # 50+ å†…ç½®éŸ³æ•ˆ
â”‚       â””â”€â”€ Images/                       # é¢„è®¾å›¾ç‰‡
â”‚
â”œâ”€â”€ ğŸ§ª CyberBugOff Watch AppTests/        # å•å…ƒæµ‹è¯•
â””â”€â”€ ğŸ§ª CyberBugOff Watch AppUITests/      # UI æµ‹è¯•
```

---

## ğŸ”„ æ•°æ®æµæ¶æ„

### å•å‘æ•°æ®æµ (Unidirectional Data Flow)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·æ“ä½œ                           â”‚
â”‚        (ç‚¹å‡»å›¾ç‰‡ã€é€‰æ‹©éŸ³æ•ˆã€è°ƒæ•´è®¾ç½®ã€è§¦å‘æ‰‹åŠ¿)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      View äº‹ä»¶                            â”‚
â”‚              (SwiftUI Button/Gesture Actions)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BugOffModel                           â”‚
â”‚              (å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œæ›´æ–°çŠ¶æ€)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ imageManager.updateSettings()                       â”‚ â”‚
â”‚  â”‚ soundManager.playSound()                            â”‚ â”‚
â”‚  â”‚ triggerManager.incrementCount()                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼ @Published å±æ€§å˜åŒ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Combine å‘å¸ƒæ›´æ–°                         â”‚
â”‚              (objectWillChange.send())                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    View è‡ªåŠ¨åˆ·æ–°                          â”‚
â”‚              (SwiftUI å“åº”å¼æ›´æ–° UI)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æŒä¹…åŒ–æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å†…å­˜çŠ¶æ€       â”‚â”€â”€â”€â–¶â”‚   DataService   â”‚â”€â”€â”€â–¶â”‚  UserDefaults   â”‚
â”‚ (BugOffModel)   â”‚    â”‚  (åºåˆ—åŒ–/ååºåˆ—åŒ–) â”‚    â”‚  (JSON å­˜å‚¨)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚  FileManager    â”‚
                       â”‚ (å›¾ç‰‡/éŸ³æ•ˆæ–‡ä»¶)   â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. å†…å­˜ä¼˜åŒ–

| ä¼˜åŒ–ç­–ç•¥ | å®ç°æ–¹å¼ | æ•ˆæœ |
|---------|---------|------|
| **ä¸‹é‡‡æ ·åŠ è½½** | CGImageSource é™åˆ¶å›¾ç‰‡å°ºå¯¸ | å†…å­˜å ç”¨ â†“82% |
| **ç»Ÿä¸€ç¼“å­˜** | CacheManager + NSCache | é¿å…é‡å¤ç¼“å­˜ |
| **LRU æ·˜æ±°** | NSCache è‡ªåŠ¨æ·˜æ±° | æŒ‰éœ€é‡Šæ”¾å†…å­˜ |
| **å†…å­˜è­¦å‘Šå“åº”** | handleMemoryWarning() | ä¸»åŠ¨æ¸…ç†ç¼“å­˜ |

### 2. åŠ è½½ä¼˜åŒ–

| ä¼˜åŒ–ç­–ç•¥ | å®ç°æ–¹å¼ | æ•ˆæœ |
|---------|---------|------|
| **æ‡’åŠ è½½** | æŒ‰éœ€åŠ è½½å›¾ç‰‡/éŸ³æ•ˆ | å¯åŠ¨æ—¶é—´ â†“50% |
| **é¢„çƒ­æœºåˆ¶** | warmUpAudioStack() | é¦–æ¬¡æ’­æ”¾æ— å»¶è¿Ÿ |
| **ç¼©ç•¥å›¾ç”Ÿæˆ** | ThumbnailGenerator | åˆ—è¡¨æ»šåŠ¨æµç•… |
| **åå°é¢„åŠ è½½** | preloadCommonImages() | æå‡å“åº”é€Ÿåº¦ |

### 3. UI ä¼˜åŒ–

| ä¼˜åŒ–ç­–ç•¥ | å®ç°æ–¹å¼ | æ•ˆæœ |
|---------|---------|------|
| **è§†å›¾å¤ç”¨** | ZStack + opacity åˆ‡æ¢ | å‡å°‘è§†å›¾é‡å»º |
| **é˜²æŠ–å¤„ç†** | Debounce åˆå¹¶æ›´æ–° | å‡å°‘æ¸²æŸ“æ¬¡æ•° |
| **å¼‚æ­¥ä¿å­˜** | DispatchQueue.global() | é¿å…ä¸»çº¿ç¨‹é˜»å¡ |

---

## ğŸ” å…³é”®è®¾è®¡æ¨¡å¼

### 1. å•ä¾‹æ¨¡å¼ (Singleton)

ç”¨äºå…¨å±€å…±äº«çš„æœåŠ¡ï¼š

```swift
class CacheManager {
    static let shared = CacheManager()
    private init() {}
    
    func getDisplayImage(for key: String) -> UIImage? { ... }
    func setDisplayImage(_ image: UIImage, for key: String) { ... }
}
```

### 2. å¤–è§‚æ¨¡å¼ (Facade)

BugOffModel ä½œä¸ºå¤–è§‚ï¼Œç®€åŒ– APIï¼š

```swift
class BugOffModel {
    // éšè—å¤æ‚çš„ Manager äº¤äº’
    func playSound(soundName: String, for imageName: String) {
        let config = getSoundConfig(for: soundName, imageName: imageName)
        soundManager.playSound(soundName: soundName, config: config)
    }
}
```

### 3. è§‚å¯Ÿè€…æ¨¡å¼ (Observer)

ä½¿ç”¨ Combine å®ç°å“åº”å¼æ›´æ–°ï¼š

```swift
// è®¢é˜…éŸ³æ•ˆåç§°ç®¡ç†å™¨å˜åŒ–
soundManager.displayNameManager.objectWillChange
    .receive(on: DispatchQueue.main)
    .sink { [weak self] _ in
        self?.updateDefaultSounds()
    }
    .store(in: &cancellables)
```

### 4. ç­–ç•¥æ¨¡å¼ (Strategy)

è§¦å‘æ¨¡å¼é‡‡ç”¨ç­–ç•¥æ¨¡å¼ï¼š

```swift
enum ImageTriggerMode: String, CaseIterable {
    case tap = "ç‚¹å‡»è§¦å‘"
    case shake = "æ‘‡æ™ƒè§¦å‘"
    case crown = "è¡¨å† è§¦å‘"
    case auto = "è‡ªåŠ¨æ’­æ”¾"
}
```

---

## ğŸ¯ æ ¸å¿ƒä¸šåŠ¡æµç¨‹

### è§¦å‘æ’­æ”¾æµç¨‹

```
ç”¨æˆ·è§¦å‘ (ç‚¹å‡»/æ‘‡æ™ƒ/è¡¨å† )
        â”‚
        â–¼
TriggerManager.detectTrigger()
        â”‚
        â”œâ”€â”€ æ£€æŸ¥è§¦å‘æ¨¡å¼
        â”‚   â””â”€â”€ ImageSettings.triggerMode
        â”‚
        â”œâ”€â”€ æ›´æ–°è®¡æ•°
        â”‚   â””â”€â”€ incrementTriggerCount()
        â”‚
        â””â”€â”€ é€šçŸ¥æ’­æ”¾
            â”‚
            â–¼
SoundManager.playSound()
        â”‚
        â”œâ”€â”€ è·å–éŸ³æ•ˆé…ç½®
        â”‚   â””â”€â”€ getSoundConfig(for:imageName:)
        â”‚
        â”œâ”€â”€ ç¡®å®šæ’­æ”¾æ¨¡å¼
        â”‚   â”œâ”€â”€ sequential: é¡ºåºæ’­æ”¾
        â”‚   â””â”€â”€ random: éšæœºæ’­æ”¾
        â”‚
        â””â”€â”€ è°ƒç”¨ AudioService
            â”‚
            â–¼
AudioService.play()
        â”‚
        â”œâ”€â”€ åº”ç”¨é…ç½® (éŸ³é‡/é€Ÿç‡/è£å‰ª)
        â”‚
        â””â”€â”€ AVAudioPlayer æ’­æ”¾
```

---

## ğŸ’¡ é¢è¯•é‡ç‚¹

### æŠ€æœ¯äº®ç‚¹

1. **åˆ†å±‚æ¶æ„è®¾è®¡** - æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œæµ‹è¯•
2. **Manager æ¨¡å¼** - ä¸šåŠ¡é€»è¾‘æ¨¡å—åŒ–ï¼Œé¿å… God Object
3. **æ€§èƒ½ä¼˜åŒ–** - ä¸‹é‡‡æ ·ã€ç»Ÿä¸€ç¼“å­˜ã€å†…å­˜ç›‘æ§
4. **å“åº”å¼ç¼–ç¨‹** - SwiftUI + Combine å®ç°æ•°æ®é©±åŠ¨ UI
5. **å¤šè§¦å‘æ–¹å¼** - ç‚¹å‡»/æ‘‡æ™ƒ/è¡¨å† å¤šç§äº¤äº’æ”¯æŒ

### æŠ€æœ¯éš¾ç‚¹

1. **watchOS å†…å­˜é™åˆ¶** - ä»…çº¦ 50MB å¯ç”¨å†…å­˜ï¼Œéœ€ç²¾ç»†ç®¡ç†
2. **éŸ³é¢‘è¿ç»­æ’­æ”¾** - å¤šéŸ³æ•ˆé¡ºåº/éšæœºæ’­æ”¾é€»è¾‘
3. **æ•°æ®è¿ç§»** - ç‰ˆæœ¬å‡çº§æ—¶çš„é…ç½®å…¼å®¹æ€§
4. **å›¾ç‰‡è£å‰ª** - è‡ªç”±åœˆé€‰è£å‰ªåŠŸèƒ½å®ç°

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ ¸å¿ƒæ¨¡å—è¯¦è§£](./CORE_MODULES.md)
- [UI ç»„ä»¶åº“](./UI_COMPONENTS.md)
- [æ•°æ®æµè¯¦è§£](./DATA_FLOW.md)
- [æ€§èƒ½ä¼˜åŒ–è¯¦è§£](./PERFORMANCE.md)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æ›´æ–°æ—¥æœŸ**: 2026-01-29
